<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Edit and customize AI-generated reports effortlessly. Make changes to the report content using our intuitive Markdown editor, download the report, or generate a final version with just a few clicks.">
    <title>Edit AI-Generated Reports | TrustyReporter</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <!-- Include stylesheet for SimpleMDE-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <!-- Custom CSS -->
    <link href="{{ url_for('dashboard.static', filename='css/report-inputs.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="navbar sticky-top navbar-expand-sm bg-body-tertiary bsb-navbar-1 shadow-sm" >
            <div class="container-fluid">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="navbar-brand" href="{{url_for('home')}}">
                            <img src="{{ url_for('dashboard.static', filename='images/logo.png')}}" class="img-fluid" alt="TrustyReporter Logo" width="135" height="44">
                        </a>
                    </li>
                </ul>             
                <div class="collapse navbar-collapse" id="bsbNavbar">
                    <ul class="navbar-nav bsb-dropdown-menu-responsive ms-auto align-items-center">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle bsb-dropdown-toggle-caret-disable" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <span class="position-relative pt-1">
                                    <i class="bi bi-person-fill fs-4"></i>
                                        <span class="visually-hidden">User</span>
                                    </span>
                                </span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-md-end bsb-dropdown-animation bsb-fadeIn">
                                <li>
                                    <h6 class="dropdown-header fs-7 text-center">Welcome, {{username}}</h6>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li>
                                    <a class="dropdown-item text-center" href="{{url_for('auth.signout')}}">
                                        <span>
                                            <span class="fs-7">Log Out</span>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div class="row" >
            <!-- Sidebar -->
            <div class="d-flex flex-column flex-shrink-0 px-3 bg-light" style="width: 20vw;">
                
                <hr class="sidebar-divider mb-3">
                <ul class="nav nav-pills flex-column mb-auto ps-3">
                    <a class= "nav-link p-1 link-dark" role="button" href="{{url_for('dashboard.index')}}">
                        <li class="nav-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-magic" viewBox="0 0 20 20">
                                <path d="M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707zM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1zM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707zM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0z"/>
                            </svg>
                            <span class="text-tertiary ms-1">AI Generated Report</span>
                        </li>
                    </a>
                    <hr class="sidebar-divider mt-3 mb-3">
                    <a class= "nav-link p-1 link-dark" role="button" href="!#">
                        <li class="nav-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chat-right-dots-fill" viewBox="0 0 20 20">
                                <path d="M16 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h9.586a1 1 0 0 1 .707.293l2.853 2.853a.5.5 0 0 0 .854-.353zM5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 1a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                            </svg>
                            <span class="text-tertiary ms-1">Chat Report</span>
                        </li>
                    </a>
                </ul>
            </div>
            <div class="main-section" style="width: 80vw;">
                <div class="container col-md-10">
                    <section id="result-section" class="my-2 my-md-4 px-1">

                        <h1>Make changes to your report below:</h1>
                        <div class="alert alert-info" role="alert">
                            <h2 style="font-size: 14px; color: #888;">Instructions:</h2>
                            <ol style="font-size: 12px; color: #555;">
                              <li>Edit the preliminary report in the Markdown editor below. Add text, data, images, and links as needed.</li>
                              <li>To provide feedback to the report generation agent, add comments prefixed with 'COMMENT' in all caps, e.g., 'COMMENT: Add a pie chart for the above data here.' or 'COMMENT: Explain the above concept in more detail.'</li>
                              <li>Once you've made your changes and added comments, click 'Generate New Report' to create an updated version with charts and graphs, or click 'Download as Markdown' to download the preliminary report as a Markdown file.</li>
                            </ol>
                        </div>

                        <!-- Create the editor container -->
                        <textarea id="editor"></textarea>

                        <div class="text-end width-90">
                            <button class="btn btn-primary button" onclick="downloadReport()"> Download as Markdown </button>
                            <button class="btn btn-primary button" onclick="openModal()"> Generate New Report </button>
                        </div>
                        
                        <!-- Modal -->
                        <div class="modal fade" id="helloModal" tabindex="-1" aria-labelledby="helloModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                <h5 class="modal-title" id="helloModalLabel">Generating Report</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <p>Generating final report...</p>
                                    <div class="spinner-border text-primary" role="status">
                                      <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <a href="#!" class="btn btn-primary">View Report</a>
                                </div>
                            </div>
                            </div>
                        </div>

                    </section>

                    <!-- Include the SimpleMDE library -->
                    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
                    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/lib/marked.umd.min.js"></script>
                    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
                    <script>
                        // Initialize SimpleMDE
                        var simplemde = new SimpleMDE({
                            element: document.getElementById("editor"),
                            hideIcons: ["fullscreen", "side-by-side"],
                            spellChecker: false,
                            autosave: {
                                enabled: true,
                                unique_id: "editor-content"
                            },
                            // Enable the preview functionality
                            previewRender: function(plainText) {
                                return this.parent.markdown(plainText);
                            },
                        });

                        // Set the initial content from the 'report' variable using Jinja
                        var initialContent = `{{ report | safe }}`;

                        // Set the initial content in the editor
                        simplemde.value(initialContent);

                        // Function to download the current content as a report.md file
                        function downloadReport() {
                            var content = simplemde.value();
                            var blob = new Blob([content], { type: "text/markdown;charset=utf-8" });
                            saveAs(blob, "report.md");
                        }
                        function openModal() {
                            var modal = new bootstrap.Modal(document.getElementById('helloModal'));
                            modal.show();
                        }
                    </script>
                  </div>
            </div>
        </div>
    </main>
    <script src="https://unpkg.com/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('dashboard.static', filename='js/report-inputs.js') }}"></script>
    
    
</body>
</html>