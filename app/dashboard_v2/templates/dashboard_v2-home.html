{% extends "dashboard_v2-layout.html" %}
{% block title %}Generate AI-Powered Reports{% endblock %}
{% block main %}
<div class="main-section" style="width: 80vw;">
    <div class="container col-md-12">
    <section class="d-flex flex-column my-1 my-md-4 px-2">
    <div class="sticky-top bg-white p-1">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Intelligence Reports</h1>
            <a href="{{url_for('dashboard_v2.submit_report')}}">
                <button class="btn btn-primary">+ New Report</button>
            </a>
        </div>
    </div>
    <div class="flex-grow-1 overflow-auto">
        <div class="table-responsive">
            <table id="reportTable" class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th class="col-0">S.No.</th>
                        <th class="col-2">Date Time</th>
                        <th class="col-5">Report Name</th>
                        <th class="col-1">Status</th>
                        <th class="col-3">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table body will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        <nav aria-label="Page navigation">
          <ul class="pagination pagination-sm justify-content-end">
            {% if current_page > 1 %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('dashboard_v2.index', page=current_page-1) }}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                  <span class="sr-only"></span>
                </a>
              </li>
            {% endif %}
        
            {% set window_size = 5 %}
            {% set window_start = [current_page - window_size//2, 1] | max %}
            {% set window_end = [window_start + window_size - 1, total_pages] | min %}
        
            {% if window_start > 1 %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('dashboard_v2.index', page=1) }}">1</a>
              </li>
              {% if window_start > 2 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
              {% endif %}
            {% endif %}
        
            {% for p in range(window_start, window_end + 1) %}
              <li class="page-item {% if p == current_page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('dashboard_v2.index', page=p) }}">{{ p }}</a>
              </li>
            {% endfor %}
        
            {% if window_end < total_pages %}
              {% if window_end < total_pages - 1 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
              {% endif %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('dashboard_v2.index', page=total_pages) }}">{{ total_pages }}</a>
              </li>
            {% endif %}
        
            {% if current_page < total_pages %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('dashboard_v2.index', page=current_page+1) }}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                  <span class="sr-only"></span>
                </a>
              </li>
            {% endif %}
          </ul>
        </nav>
    </div>
    </section>
    </div>
</div>
<div class="modal fade" id="processingModal" tabindex="-1" aria-labelledby="processingModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="processingModalLabel">Report Status</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Report is still processing. Please try again later.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block custom_javascript %}
<script>
    var REPORTS_URL = "{{ url_for('dashboard_v2.get_reports') }}";
    var currentPage = "{{current_page}}"
    var reportsPerPage = "{{reports_per_page}}"
    var VIEW_REPORT_URL = "{{ url_for('dashboard_v2.view_report',report_id='_REPORT_ID_') }}";
    var VIEW_LOGS_URL = "{{ url_for('dashboard_v2.view_logs',report_id='_REPORT_ID_') }}"
    var CHAT_REPORT_URL = "{{ url_for('dashboard_v2.chat_report',report_id='_REPORT_ID_') }}"
    var SSE_URL = "{{ url_for('sse.stream', _external=True) }}";
    var CHANNEL_ID = "{{ current_user_channel }}";
    // console.log('CHANNEL_ID before creating EventSource:', CHANNEL_ID);
</script>
<script src="{{ url_for('dashboard_v2.static', filename='js/report-table.js') }}"></script>
{% endblock %}