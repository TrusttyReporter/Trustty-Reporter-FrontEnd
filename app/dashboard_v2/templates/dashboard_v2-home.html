{% extends "dashboard_v2-layout.html" %}
{% block title %}Generate AI-Powered Reports{% endblock %}
{% block main %}
<div class="main-section" style="width: 80vw;">
    <div class="container col-md-12">
    <section class="d-flex flex-column my-1 my-md-4 px-2">
    <div class="sticky-top bg-white p-1">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Intelligence Reports</h1>
            <a href="{{url_for('dashboard_v2.submit_report')}}">
                <button class="btn btn-primary">+ New Report</button>
            </a>
        </div>
    </div>
    <div class="flex-grow-1 overflow-auto">
        <div class="table-responsive">
            <table id="reportTable" class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th class="col-0">S.No.</th>
                        <th class="col-2">Date Time</th>
                        <th class="col-4">Report Name</th>
                        <th class="col-1">Status</th>
                        <th class="col-5">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table body will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    </section>
    </div>
</div>
<div class="modal fade" id="processingModal" tabindex="-1" aria-labelledby="processingModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="processingModalLabel">Report Status</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Report is still processing. Please try again later.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block custom_javascript %}
<script>
    var REPORTS_URL = "{{ url_for('dashboard_v2.get_reports') }}";
    var VIEW_REPORT_URL = "{{ url_for('dashboard_v2.view_report',report_id='_REPORT_ID_') }}";
    var VIEW_LOGS_URL = "{{ url_for('dashboard_v2.view_logs',report_id='_REPORT_ID_') }}"
    var EDIT_REPORT_URL = "#"
    var SSE_URL = "{{ url_for('sse.stream', _external=True) }}";
    var CHANNEL_ID = "{{ current_user_channel }}";
    console.log('CHANNEL_ID before creating EventSource:', CHANNEL_ID);
</script>
<script src="{{ url_for('dashboard_v2.static', filename='js/report-table.js') }}"></script>
{% endblock %}